# @configure_input@

Summary:        Graph Visualization Tools
Name:           graphviz
Version:        @VERSION@
Release:        1
Group:          Applications/Multimedia
License:        CPL
URL:            http://www.graphviz.org/
Source:		http://www.graphviz.org/pub/graphviz/ARCHIVE/%{name}-%{version}.tar.gz
Packager:       John Ellson (ellson@graphviz.org)
Vendor:         http://www.graphviz.org/

# SuSE uses a different mechanism to generate BuildRequires
# norootforbuild
# neededforbuild  expat freetype2 freetype2-devel gcc libjpeg libpng-devel-packages tcl tcl-devel tk tk-devel x-devel-packages

BuildRequires: /bin/ksh tcl >= 0:8.3 tk expat expat-devel libjpeg
Buildrequires: libjpeg-devel libpng libpng-devel zlib zlib-devel
# Buildrequires: swig java java-devel perl python python-devel ruby ruby-devel
%{?fc4:BuildRequires: freetype >= 2 freetype-devel fontconfig fontconfig-devel tcl-devel tk-devel xorg-x11-devel} 
%{?fc3:BuildRequires: freetype >= 2 freetype-devel fontconfig fontconfig-devel tcl-devel tk-devel xorg-x11-devel} 
%{?fc2:BuildRequires: freetype >= 2 freetype-devel fontconfig fontconfig-devel tcl-devel tk-devel XFree86-devel}
%{?fc1:BuildRequires: freetype >= 2 freetype-devel fontconfig fontconfig-devel tcl-devel tk-devel XFree86-devel}
%{?el4:BuildRequires: freetype >= 2 freetype-devel fontconfig fontconfig-devel tcl-devel tk-devel xorg-x11-devel}
%{?el3:BuildRequires: freetype >= 2 freetype-devel fontconfig fontconfig-devel tcl-devel tk-devel XFree86-devel}
%{?rh9:BuildRequires: freetype >= 2 freetype-devel XFree86-devel}
%{?rh8:BuildRequires: freetype >= 2 freetype-devel XFree86-devel}
%{?rh7:BuildRequires: freetype >= 2 freetype-devel XFree86-devel}
%{?el2:BuildRequires: freetype >= 2 freetype-devel XFree86-devel}
%{?rh6:BuildRequires: freetype >= 2 freetype-devel XFree86-devel}

BuildRoot:	%{_tmppath}/%{name}-%{version}-%{release}-buildroot
Prefix:         %{_prefix}

%description
A collection of tools and tcl packages for the manipulation and layout
of graphs (as in nodes and edges, not as in barcharts).

%package devel
Group:		Development/Libraries
Summary:	Development tools for using the %{name} libraries.
Requires:	%{name} = %{version}-%{release} %{name}-tcl = %{version}-%{release}
# The following doesn't work on RH9 or RHE where there is no tcl-devel
#Requires: tcl-devel tk-devel

%description devel
The %{name}-devel package contains the header files
and man3 pages necessary for developing programs
using version %{version} of the %{name} libraries.

%package doc
Group:          Documentation
Summary:        PDF and HTML documents for %{name}

%description doc
The %{name}-doc package provides some additional PDF and HTML documentation for %{name}.

%package graphs
Group:		Applications/Multimedia
Summary:	Demo graphs for %{name}

%description graphs
This package provides some example graphs for %{name}.

%package java
Group:		Applications/Multimedia
Summary:	Java extension tools for %{name}
Requires:	%{name} = %{version}-%{release} java

%description java
The %{name}-java package contains a java module (extension)
for version %{version} of the %{name} tools.

%package perl
Group:		Applications/Multimedia
Summary:	Perl extension tools for %{name}
Requires:	%{name} = %{version}-%{release} perl

%description perl
The %{name}-perl package contains a perl module (extension)
for version %{version} of the %{name} tools.

%package python
Group:		Applications/Multimedia
Summary:	Perl extension tools for %{name}
Requires:	%{name} = %{version}-%{release} python

%description python
The %{name}-python package contains a python module (extension)
for version %{version} of the %{name} tools.

%package ruby
Group:		Applications/Multimedia
Summary:	Perl extension tools for %{name}
Requires:	%{name} = %{version}-%{release} ruby

%description ruby
The %{name}-ruby package contains a ruby module (extension)
for version %{version} of the %{name} tools.

%package tcl
Group:		Applications/Multimedia
Summary:	Tcl extension tools for %{name}
Requires:	%{name} = %{version}-%{release} tcl >= 0:8.3 tk

%description tcl
The %{name}-tcl package contains various tcl packages (extensions)
for version %{version} of the %{name} tools.

%prep
%setup -q

%build
# XXX ix86 only used to have -ffast-math, let's use everywhere
%{expand: %%define optflags %{optflags} -ffast-math}
# %%configure is broken in RH7.3 rpmbuild - even in comments!
# need unreleased changes to gd, so use --with-mylibgd for now.
CFLAGS="$RPM_OPT_FLAGS" \
./configure \
      --prefix=%{_prefix} \
      --bindir=%{_bindir} \
      --libdir=%{_libdir} \
      --includedir=%{_includedir} \
      --datadir=%{_datadir} \
      --mandir=%{_mandir} \
      --with-x \
      --disable-gvrender \
      --with-mylibgd \
      --disable-dependency-tracking
# need gd-2.0.29 commonly available in rpms before removing --enable-mylibgd
%__make %{?_smp_mflags}

%install
rm -rf $RPM_BUILD_ROOT __doc
make \
    DESTDIR=$RPM_BUILD_ROOT \
    docdir=$RPM_BUILD_ROOT%{_docdir}/%{name} \
    pkgconfigdir=%{_libdir}/pkgconfig \
    transform='s,x,x,' \
	install
cp -a $RPM_BUILD_ROOT%{_datadir}/%{name}/doc __doc
rm -rf $RPM_BUILD_ROOT%{_datadir}/%{name}/doc

%clean
rm -rf $RPM_BUILD_ROOT

%files
%defattr(-,root,root,-)
%doc AUTHORS COPYING ChangeLog NEWS README
%{_bindir}/*
%dir %{_libdir}/%{name}
%{_libdir}/%{name}/*.so.*
%{_mandir}/man1/*.1*
%dir %{_datadir}/%{name}
%{_datadir}/%{name}/lefty
%exclude %{_libdir}/%{name}/lib*_java.so.*
%exclude %{_libdir}/%{name}/lib*_perl.so.*
%exclude %{_libdir}/%{name}/lib*_python.so.*
%exclude %{_libdir}/%{name}/lib*_ruby.so.*
%exclude %{_libdir}/%{name}/lib*tcl*.so.*
%exclude %{_libdir}/%{name}/libtk*.so.*
%exclude %{_bindir}/dotneato-config
%exclude %{_mandir}/man1/dotneato-config.1*

%files devel
%defattr(-,root,root,-)
%{_bindir}/dotneato-config
%{_includedir}/%{name}
%{_libdir}/%{name}/*.*a
%{_libdir}/%{name}/*.so
%{_libdir}/pkgconfig/*.pc
%{_mandir}/man1/dotneato-config.1*
%{_mandir}/man3/*.3*
%exclude %{_libdir}/%{name}/lib*tcl*.*
%exclude %{_libdir}/%{name}/libtk*.*
%exclude %{_libdir}/%{name}/lib*_perl*.*
%exclude %{_libdir}/%{name}/lib*_python*.*
%exclude %{_libdir}/%{name}/lib*_ruby*.*

%files doc
%defattr(-,root,root,-)
%doc __doc/*

%files graphs
%defattr(-,root,root,-)
%dir %{_datadir}/%{name}
%{_datadir}/%{name}/graphs

%files java
%defattr(-,root,root,-)
%{_libdir}/%{name}/lib*_java*.so.*.*.*
%{_libdir}/%{name}/*.java

%files perl
%defattr(-,root,root,-)
%{_libdir}/%{name}/lib*_perl*.so.*.*.*
%{_libdir}/%{name}/gv.pm

%files python
%defattr(-,root,root,-)
%{_libdir}/%{name}/lib*_python*.so.*.*.*
%{_libdir}/%{name}/gv.py

%files ruby
%defattr(-,root,root,-)
%{_libdir}/%{name}/lib*_ruby*.so.*.*.*

%files tcl
%defattr(-,root,root,-)
%{_libdir}/%{name}/lib*tcl*.so.*.*.*
%{_libdir}/%{name}/libtk*.so.*.*.*
%{_libdir}/%{name}/pkgIndex.tcl
%{_datadir}/%{name}/demo
%{_mandir}/mann/* 
