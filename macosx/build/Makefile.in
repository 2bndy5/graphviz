# tools

MAKE=make
PACKAGEMAKER=/Developer/Applications/Utilities/PackageMaker.app/Contents/MacOS/PackageMaker
XCODEBUILD=xcodebuild

# local

LOCAL=/usr/local
LOCAL_LIB=$(LOCAL)/lib

# base

GV_DIR=../..
GVC=libgvc.la

#
# graphviz
#

graphviz-@VERSION@.pkg: usr/local/lib/$(GVC) Release/Graphviz.app
	@echo
	@echo PACKAGING GRAPHVIZ...
	@echo
	$(PACKAGEMAKER) --doc ../graphviz.pmdoc --out $@

usr/local/lib/$(GVC): $(GV_DIR)/lib/gvc/$(GVC)
	@echo
	@echo INSTALLING GRAPHVIZ...
	@echo
	$(MAKE) DESTDIR=$(CURDIR) -C $(GV_DIR) install-strip
	
Release/Graphviz.app: $(GV_DIR)/lib/gvc/$(GVC)
	@echo
	@echo BUILDING GRAPHVIZ GUI...
	@echo
	$(XCODEBUILD) -project ../graphviz.xcodeproj -configuration Release

$(GV_DIR)/lib/gvc/$(GVC): $(GV_DIR)/Makefile
	@echo
	@echo MAKING GRAPHVIZ...
	@echo
	if [[ -e $@ ]]; then $(MAKE) -C $(GV_DIR) clean; fi && \
	$(MAKE) -C $(GV_DIR)/tclpkg/tkstubs && \
	$(MAKE) -C $(GV_DIR)/tclpkg/tclstubs && \
	$(MAKE) -C $(GV_DIR)/tclpkg/tkspline CFLAGS="-arch ppc -arch i386" LDFLAGS="-arch ppc -arch i386" && \
	$(MAKE) -C $(GV_DIR)
	
$(GV_DIR)/Makefile: $(GV_DIR)/configure
	@echo
	@echo CONFIGURING GRAPHVIZ...
	@echo
	cd $(GV_DIR) && /configure --disable-dependency-tracking --with-ipsepcola --with-quartz CFLAGS="-O2 -arch ppc -arch i386 -arch ppc64 -arch x86_64" CXXFLAGS="-O2 -arch ppc -arch i386 -arch ppc64 -arch x86_64" LDFLAGS="-arch ppc -arch i386 -arch ppc64 -arch x86_64 -Wl,-dead_strip -Wl,-dead_strip_dylibs"



